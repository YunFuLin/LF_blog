---
title: reactå¼•å…¥æ’ä»¶æŠ¥é”™Errorï¼šMinified React error 321
date: 2022-10-11 14:57:13
layout: 'archives'
urlname: notes
keywords: 'reactå¼•å…¥æ’ä»¶æŠ¥é”™Errorï¼šMinified React error 321'
tags: 
- react
- webpack
categories: 
- ç¬”è®°
---

æˆ‘åœ¨react16.8ä¹‹å‰ä¸æ”¯æŒhookçš„é¡¹ç›®ä¸Šï¼Œå¼•å…¥æ‹–æ‹½æ’ä»¶æŠ¥é”™#321,æç¤ºError: Minified React error #321ï¼Œreactå®˜æ–¹([https://reactjs.org/warnings/invalid-hook-call-warning.html](https://reactjs.org/warnings/invalid-hook-call-warning.html))æç¤ºå¯¼è‡´å¯èƒ½è¿™ä¸ªé”™è¯¯çš„åŸå› å¦‚ä¸‹ï¼š
![](no-009/1.png)
#### 1ã€åœ¨package.jsonæ–‡ä»¶ä¸­æˆ‘çš„reactç‰ˆæœ¬æ˜¯
```javascript
"react": "^16.5.2",
"react-dom": "^16.5.2",
```
æ™®åŠä¸€ä¸‹package.jsonæ–‡ä»¶ä¸­ï¼Œ^ å’Œ ~ çš„åŒºåˆ«ï¼š

<font color=red> ^ </font>ï¼šå®ƒå°†å½“å‰åº“çš„ç‰ˆæœ¬æ›´æ–°åˆ°ç¬¬ä¸€ä¸ªæ•°å­—ï¼ˆmajor version)ä¸­çš„æœ€æ–°ç‰ˆæœ¬ï¼Œæ¯”å¦‚ï¼š<font color=red> â€œ^16.5.2â€ </font>ï¼Œåº“ä¼šåŒ¹é…æ›´æ–°åˆ°<font color=red> 16.X.X </font>çš„æœ€æ–°ç‰ˆæœ¬(ä¹Ÿå°±æ˜¯16.14.0)ï¼Œä½†æ˜¯ä¸ä¼šæ›´æ–°åˆ°17.X.Xç‰ˆæœ¬

<font color=red> ~ </font>ï¼šå½“ä¸‹è½½çš„æ—¶å€™ï¼Œå®ƒä¼šè‡ªåŠ¨æ›´æ–°åˆ°ä¸­é—´é‚£ä¸ªæ•°å­—ï¼ˆminor versionï¼‰çš„æœ€æ–°ç‰ˆæœ¬ï¼Œæ¯”å¦‚ï¼šâ€œ~4.2.0â€ï¼Œåº“å°±ä¼šæ›´æ–°åˆ° 4.2.X çš„æœ€æ–°ç‰ˆæœ¬ï¼Œä½†æ˜¯ä¸ä¼šæ›´æ–°åˆ°4.3.Xç‰ˆæœ¬ï¼Œæ³¢æµªç¬¦å·æ˜¯æ›¾ç» npm å®‰è£…æ—¶å€™çš„é»˜è®¤ç¬¦å·ï¼Œç°åœ¨å·²ç»å˜ä¸ºäº†æ’å…¥ç¬¦å·

åœ¨ node_modules ä¸­ <font color=red> react </font>å’Œ <font color=red> react-dom </font> å¯ä»¥çœ‹åˆ°ä»–çš„ç‰ˆæœ¬å·²ç»å‡çº§åˆ°äº† 16.14.0ğŸ˜®ï¼Œä¹Ÿå°±æ˜¯è¯´ä»–æ˜¯æ”¯æŒhookçš„

#### 2ã€é€ä¸ªæ’æŸ¥
```javascript
ç¡®å®š react å’Œ react-dom æ˜¯ç›¸åŒç‰ˆæœ¬ï¼Œ16.14.0ï¼Œæ”¯æŒhooksè¯­æ³•
ç¡®å®šè‡ªå·±çš„ä»£ç æ²¡æœ‰è¿èƒŒhooksçš„ä½¿ç”¨å‡†åˆ™
é¡¹ç›®ä¸­å¼•å…¥äº†ä¸æ­¢ä¸€ä¸ªreactå®ä¾‹ï¼Ÿï¼Ÿï¼Ÿ
```
å¾ˆå¿«å®šä½åˆ°æ˜¯ç¬¬ä¸‰ä¸ªåŸå› ï¼Œé‚£å°±è¯´æ˜åº”è¯¥æ˜¯æ‰“åŒ…çš„é…ç½®æ–‡ä»¶æœ‰é—®é¢˜ï¼Œæˆ‘è¿™è¾¹ç”¨çš„æ˜¯webpacké…ç½®ï¼Œè€Œä¸”æ˜¯ç”¨äº† dll æŠ½ç¦»æ‰“åŒ…ï¼Œåœ¨ webpack.dll.config.js è¿™ä¸ªé¢„æ‰“åŒ…æ–‡ä»¶

![](no-009/2.png)

react-redux æ˜¯ä¾èµ– react çš„ï¼Œæ”¾åˆ°reduxè¿™ä¸ªå…¥å£ï¼Œæ‰“åŒ…ä¼šäº§ç”Ÿä¸¤ä¸ªreactå®ä¾‹ï¼Œè§£å†³åŠæ³•å¾ˆç®€å•ï¼Œç§»åŠ¨åˆ° vendor çš„å…¥å£ï¼Œå†æ‰“åŒ…å°±ä¸ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜äº†

#### 3ã€é‚£æˆ‘ä»¬æ€ä¹ˆçŸ¥é“ react-redux æ˜¯ä¾èµ– react çš„ï¼Œè€Œ redux-router-redux å´æ²¡æœ‰ä¾èµ–reactå‘¢

æˆ‘ä½¿ç”¨çš„æ˜¯ Node è¿›è¡ŒåŒ…ç®¡ç†ï¼Œåœ¨é¡¹ç›®æ–‡ä»¶å¤¹ä¸­è¿è¡Œæ­¤æ£€æŸ¥ï¼š
```javascript
npm ls react
```
![](no-009/3.png)

npm ls react è¿™ä¸ªå‘½ä»¤ä¼šå‘Šè¯‰æˆ‘ä»¬ï¼Œæœ‰å“ªäº›æ’ä»¶æ˜¯ä¾èµ– react çš„ï¼Œå¾ˆæ˜¾ç„¶ä¸Šé¢æ²¡æœ‰ redux-router-reduxï¼ˆé‚£å°±æ˜¯å®ƒæ²¡æœ‰ä¾èµ–reactï¼‰ï¼Œä½†æ˜¯æœ‰ react-redux

#### 4ã€å¯ä»¥å°è¯•é€šè¿‡æ·»åŠ ä¸€äº›æ—¥å¿—å¹¶é‡æ–°å¯åŠ¨å¼€å‘æœåŠ¡å™¨æ¥è°ƒè¯•æ­¤é—®é¢˜ï¼š
```javascript
// åœ¨ node_modules/react-dom/index.js æ·»åŠ 
window.React1 = require('react');

// åœ¨éšæ„ä¸€ä¸ªç»„ä»¶é‡Œæ·»åŠ ï¼ˆæˆ‘æ˜¯åœ¨é¦–é¡µï¼‰
require('react-dom');
window.React2 = require('react');
console.log(window.React1 === window.React2);
```
å¦‚æœå®ƒæ‰“å°äº†ï¼Œfalseé‚£ä¹ˆä½ å¯èƒ½æœ‰ä¸¤ä¸ª React

å¦‚æœä½ çš„ react-dom æ˜¯æ”¾åœ¨äº† webpack.dll.config.js æ–‡ä»¶é‡Œ
é‚£ä¹ˆä¿®æ”¹ä¿å­˜åï¼Œä½ è¦å…ˆæ‰§è¡Œ npm run dllï¼Œå†æ‰§è¡Œnpm run dev

ç„¶åå°±å¤§åŠŸå‘Šæˆæ‹‰â¤ï¸â¤ï¸â¤ï¸å¯ä»¥ä½¿ç”¨æ”¯æŒhookçš„æ–°è½®å­ğŸ‘